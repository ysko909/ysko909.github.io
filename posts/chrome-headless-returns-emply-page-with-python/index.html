<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Headless ChromeをPythonで使おうとしたら空っぽのページが返ってきた - 頑張らないために頑張る</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:title" content="Headless ChromeをPythonで使おうとしたら空っぽのページが返ってきた" />
<meta property="og:description" content="はじめに Python、SeleniumにChromeの組み合わせは、PhantomJSが息絶えてしまった今では自動化の王道だと思います。そんな王道の組み合わせをWindowsで試してたら、Headlessモードの時だけページの取得が上手くできない事象を目撃しましたので、メモしておきます。Headlessモードじゃないなら正常なのに、Headlessモードへ変更した途端におかしくなってしまいました。
環境  Windows 10 Python 3.6.8 ChromeDriver 2.38.552522 Google Chrome 80.0.3965.0（Official Build）canary （64 ビット）  現象 どんなURLを指定しても、HeadlessモードではSeleniumで取得した結果が空っぽのHTMLになってしまいます。Headlessモードを外すだけで、ちゃんと取得します。謎。
Chrome用ソース Chromedriverは、インストール先のパスが通っている前提です。
import time from selenium import webdriver from selenium.webdriver.chrome.options import Options options = Options() options.add_argument(&#39;--headless&#39;) options.add_argument(&#39;--disable-gpu&#39;) options.binary_location = &#39;Chrome Canaryのアドレス&#39; driver = webdriver.Chrome(options=options) driver.get(&#39;https://www.yahoo.co.jp/&#39;) time.sleep(3) html = driver.page_source print(html) driver.save_screenshot(&#34;hoge.png&#34;) driver.quit() 多分、極端に変なことはしてないと思うんですが、これが動作するとコンソールには下記のHTMLソースが表示されます。
&lt;html xmlns=&#34;http://www.w3.org/1999/xhtml&#34;&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt; 中身空っぽじゃねーかよ！
実際save_screenshotで生成されるファイルを見てみると下記の通りです。
オドロキの白さ！
まぁそうですわな、HTMLファイル中に何もないんだから。
Headlessモードを外してみる ソースはこんな感じ。Headlessモードをコメントで外しただけです。
import time from selenium import webdriver from selenium.webdriver.chrome.options import Options options = Options() # options." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://idontwannawork.github.io/posts/chrome-headless-returns-emply-page-with-python/" /><meta property="article:published_time" content="2019-11-13T15:14:28&#43;09:00"/>
<meta property="article:modified_time" content="2019-11-13T15:14:28&#43;09:00"/><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Headless ChromeをPythonで使おうとしたら空っぽのページが返ってきた"/>
<meta name="twitter:description" content="はじめに Python、SeleniumにChromeの組み合わせは、PhantomJSが息絶えてしまった今では自動化の王道だと思います。そんな王道の組み合わせをWindowsで試してたら、Headlessモードの時だけページの取得が上手くできない事象を目撃しましたので、メモしておきます。Headlessモードじゃないなら正常なのに、Headlessモードへ変更した途端におかしくなってしまいました。
環境  Windows 10 Python 3.6.8 ChromeDriver 2.38.552522 Google Chrome 80.0.3965.0（Official Build）canary （64 ビット）  現象 どんなURLを指定しても、HeadlessモードではSeleniumで取得した結果が空っぽのHTMLになってしまいます。Headlessモードを外すだけで、ちゃんと取得します。謎。
Chrome用ソース Chromedriverは、インストール先のパスが通っている前提です。
import time from selenium import webdriver from selenium.webdriver.chrome.options import Options options = Options() options.add_argument(&#39;--headless&#39;) options.add_argument(&#39;--disable-gpu&#39;) options.binary_location = &#39;Chrome Canaryのアドレス&#39; driver = webdriver.Chrome(options=options) driver.get(&#39;https://www.yahoo.co.jp/&#39;) time.sleep(3) html = driver.page_source print(html) driver.save_screenshot(&#34;hoge.png&#34;) driver.quit() 多分、極端に変なことはしてないと思うんですが、これが動作するとコンソールには下記のHTMLソースが表示されます。
&lt;html xmlns=&#34;http://www.w3.org/1999/xhtml&#34;&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt; 中身空っぽじゃねーかよ！
実際save_screenshotで生成されるファイルを見てみると下記の通りです。
オドロキの白さ！
まぁそうですわな、HTMLファイル中に何もないんだから。
Headlessモードを外してみる ソースはこんな感じ。Headlessモードをコメントで外しただけです。
import time from selenium import webdriver from selenium.webdriver.chrome.options import Options options = Options() # options."/>
<link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,300italic,400italic|Raleway:200,300"
		rel="stylesheet">

	<link rel="stylesheet" type="text/css" media="screen" href="https://idontwannawork.github.io/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://idontwannawork.github.io/css/main.css" />
	<link rel="stylesheet" type="text/css" href="https://idontwannawork.github.io/css/dark.css"
		 />
	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script><script src="https://idontwannawork.github.io/js/main.js"></script>
	<script data-ad-client="ca-pub-2615583270378842" async
		src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

	<script data-ad-client="ca-pub-2615583270378842" async
		src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
</head>
<body>
	<div class="container wrapper post">
		<div class="header">
	<h1 class="site-title">頑張らないために頑張る</h1>
	<div class="site-description"><h2>ゆるく頑張ります</h2><nav class="nav social">
			<ul class="flat"><a href="https://twitter.com/unknown_strings" title="Twitter"><i data-feather="twitter"></i></a><a href="https://github.com/idontwannawork" title="Github"><i data-feather="github"></i></a><a href="/index.xml" title="RSS"><i data-feather="rss"></i></a></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/">Home</a>
			</li>
			
			<li>
				<a href="/about">About</a>
			</li>
			
			<li>
				<a href="https://forms.gle/mtbEheX7qDrZfKPP8">Contact</a>
			</li>
			
			<li>
				<a href="ppolicy/">Privacy policy</a>
			</li>
			
			<li>
				<a href=""></a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post-header">
			<h1 class="title">Headless ChromeをPythonで使おうとしたら空っぽのページが返ってきた</h1>
			<div class="meta">Posted at &mdash; Nov 13, 2019</div>
		</div>

		<div class="markdown">
			

<h2 id="はじめに">はじめに</h2>

<p>Python、SeleniumにChromeの組み合わせは、PhantomJSが息絶えてしまった今では自動化の王道だと思います。そんな王道の組み合わせをWindowsで試してたら、<strong>Headlessモードの時だけページの取得が上手くできない</strong>事象を目撃しましたので、メモしておきます。Headlessモードじゃないなら正常なのに、Headlessモードへ変更した途端におかしくなってしまいました。</p>

<h2 id="環境">環境</h2>

<ul>
<li>Windows 10</li>
<li>Python 3.6.8</li>
<li>ChromeDriver 2.38.552522</li>
<li>Google Chrome 80.0.3965.0（Official Build）canary （64 ビット）</li>
</ul>

<h2 id="現象">現象</h2>

<p>どんなURLを指定しても、HeadlessモードではSeleniumで取得した結果が<strong>空っぽのHTML</strong>になってしまいます。Headlessモードを外すだけで、ちゃんと取得します。<strong>謎</strong>。</p>

<h2 id="chrome用ソース">Chrome用ソース</h2>

<p>Chromedriverは、インストール先のパスが通っている前提です。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#00f">import</span> time
<span style="color:#00f">from</span> selenium <span style="color:#00f">import</span> webdriver
<span style="color:#00f">from</span> selenium.webdriver.chrome.options <span style="color:#00f">import</span> Options

options = Options()
options.add_argument(<span style="color:#a31515">&#39;--headless&#39;</span>)
options.add_argument(<span style="color:#a31515">&#39;--disable-gpu&#39;</span>)
options.binary_location = <span style="color:#a31515">&#39;Chrome Canaryのアドレス&#39;</span>

driver = webdriver.Chrome(options=options)

driver.get(<span style="color:#a31515">&#39;https://www.yahoo.co.jp/&#39;</span>)

time.sleep(3)

html = driver.page_source
<span style="color:#00f">print</span>(html)

driver.save_screenshot(<span style="color:#a31515">&#34;hoge.png&#34;</span>)

driver.quit()</code></pre></div>
<p>多分、極端に変なことはしてないと思うんですが、これが動作するとコンソールには下記のHTMLソースが表示されます。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">&lt;html xmlns=&#34;http://www.w3.org/1999/xhtml&#34;&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;</code></pre></div>
<p><strong>中身空っぽじゃねーかよ！</strong></p>

<p>実際<code>save_screenshot</code>で生成されるファイルを見てみると下記の通りです。</p>

<p><img src="2019-11-13-15-33-42.png" alt="pic" /></p>

<p><strong>オドロキの白さ！</strong></p>

<p>まぁそうですわな、HTMLファイル中に何もないんだから。</p>

<h2 id="headlessモードを外してみる">Headlessモードを外してみる</h2>

<p>ソースはこんな感じ。Headlessモードをコメントで外しただけです。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#00f">import</span> time
<span style="color:#00f">from</span> selenium <span style="color:#00f">import</span> webdriver
<span style="color:#00f">from</span> selenium.webdriver.chrome.options <span style="color:#00f">import</span> Options

options = Options()
<span style="color:#008000"># options.add_argument(&#39;--headless&#39;)</span>
options.add_argument(<span style="color:#a31515">&#39;--disable-gpu&#39;</span>)
options.binary_location = <span style="color:#a31515">&#39;Chrome Canaryのアドレス&#39;</span>

driver = webdriver.Chrome(options=options)

driver.get(<span style="color:#a31515">&#39;https://www.yahoo.co.jp/&#39;</span>)

time.sleep(3)

html = driver.page_source
<span style="color:#00f">print</span>(html)

driver.save_screenshot(<span style="color:#a31515">&#34;hoge.png&#34;</span>)

driver.quit()</code></pre></div>
<p>これを実行すると数秒だけChromeの画面が出現します。Headlessモードじゃないから当たり前ですね。その後コンソールを見てみると、下記の通り取得したHTMLソースが表示されています。なお、すべてを記述すると長いので省略しています。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">&lt;!DOCTYPE html&gt;&lt;html xmlns=&#34;http://www.w3.org/1999/xhtml&#34; lang=&#34;ja&#34;&gt;&lt;head&gt;&lt;meta charset=&#34;utf-8&#34; /&gt;&lt;meta http-equiv=&#34;X-UA-Compatible&#34; content=&#34;IE=edge,chrome=1&#34; /&gt;&lt;title&gt;Yahoo! JAPAN&lt;/title&gt;&lt;meta name=&#34;description&#34; content=&#34;あなたの毎日をアップデートする情報ポータル。検索、ニュース、天気、スポーツ、メール、ショッピング、オークションなど便利なサービスを展開しています。&#34; /&gt;&lt;meta name=&#34;robots&#34; content=&#34;noodp&#34; /&gt;&lt;meta name=&#34;viewport&#34; content=&#34;width=1010&#34; /&gt;&lt;link rel=&#34;dns-prefetch&#34; href=&#34;//s.yimg.jp&#34; /&gt;&lt;link rel=&#34;dns-prefetch&#34; href=&#34;//yads.c.yimg.jp&#34; /&gt;&lt;meta name=&#34;google-site-verification&#34; content=&#34;fsLMOiigp5fIpCDMEVodQnQC7jIY1K3UXW5QkQcBmVs&#34; /&gt;&lt;link rel=&#34;alternate&#34; href=&#34;android-app://jp.co.yahoo.android.yjtop/yahoojapan/home/top&#34; /&gt;&lt;link rel=&#34;alternate&#34; media=&#34;only screen and (max-width: 640px)&#34; href=&#34;https://m.yahoo.co.jp/&#34; /&gt;&lt;link rel=&#34;canonical&#34; href=&#34;https://www.yahoo.co.jp/&#34; /&gt;&lt;link rel=&#34;shortcut icon&#34; href=&#34;https://s.yimg.jp/c/icon/s/bsc/2.0/favicon.ico&#34; type=&#34;image/vnd.microsoft.icon&#34; /&gt;&lt;link rel=&#34;icon&#34; href=&#34;https://s.yimg.jp/c/icon/s/bsc/2.0/favicon.ico&#34; type=&#34;image/vnd.microsoft.icon&#34; /&gt;&lt;meta property=&#34;og:title&#34; content=&#34;Yahoo! JAPAN&#34; /&gt;&lt;meta property=&#34;og:type&#34; content=&#34;website&#34; /&gt;&lt;meta property=&#34;og:url&#34; content=&#34;https://www.yahoo.co.jp/&#34; /&gt;&lt;meta property=&#34;og:image&#34; content=&#34;https://s.yimg.jp/images/top/ogp/fb_y_1500px.png&#34; /&gt;&lt;meta property=&#34;og:description&#34; content=&#34;あなたの毎日をアップデートする情報ポータル。検索、ニュース、天気、スポーツ、メール、ショッピング、オークションなど便利なサービスを
展開しています。&#34; /&gt;&lt;meta property=&#34;og:site_name&#34; content=&#34;Yahoo! JAPAN&#34; /&gt;&lt;meta property=&#34;twitter:card&#34; content=&#34;summary_large_image&#34; /&gt;&lt;meta property=&#34;twitter:site&#34; content=&#34;@Yahoo_JAPAN_PR&#34; /&gt;&lt;meta property=&#34;twitter:image&#34; content=&#34;https://s.yimg.jp/images/top/ogp/tw_y_1400px.png&#34; /&gt;&lt;meta property=&#34;fb:app_id&#34; content=&#34;472870002762883&#34; /&gt;&lt;link rel=&#34;stylesheet&#34; href=&#34;//s.yimg.jp/images/top/orion/1.0.17/bundle_1.0.17.css&#34; /&gt;&lt;script
async=&#34;&#34; data-jsonpid=&#34;&#34; src=&#34;https://cdn-gl.imrworldwide.com/novms/js/2/nlsSDK600.bundle.min.js&#34;&gt;&lt;/script&gt;・・・（以下省略）</code></pre></div>
<p>HTMLがちゃんと取得できているのだから、スクリーンショットも正常に取得できています。なお、スクリーンショット画像は下部分を省略しました。</p>

<p><img src="2019-11-13-15-38-36.png" alt="pic" /></p>

<p>ただHeadlessモードを摘要するだけで、こうも挙動が違うものなんでしょうか。</p>

<h2 id="なんとかしてみる">なんとかしてみる</h2>

<h3 id="その1-引数を追加">（その1）引数を追加</h3>

<p><a href="https://stackoverflow.com/questions/47715071/chrome-headless-in-unix-returns-empty-page-source">ここ</a>を参考に、Chrome実行時の引数を追加してみました。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#00f">import</span> time
<span style="color:#00f">from</span> selenium <span style="color:#00f">import</span> webdriver
<span style="color:#00f">from</span> selenium.webdriver.chrome.options <span style="color:#00f">import</span> Options

options = Options()
options.add_argument(<span style="color:#a31515">&#39;--headless&#39;</span>)
options.add_argument(<span style="color:#a31515">&#39;--disable-gpu&#39;</span>)
options.set_headless(headless=True)
options.add_argument(<span style="color:#a31515">&#39;--ignore-ssl-errors=true&#39;</span>)
options.add_argument(<span style="color:#a31515">&#39;--ssl-protocol=any&#39;</span>)
options.add_argument(<span style="color:#a31515">&#39;--no-sandbox&#39;</span>)
options.binary_location = <span style="color:#a31515">&#39;Chrome Canaryのアドレス&#39;</span>

driver = webdriver.Chrome(options=options)

driver.get(<span style="color:#a31515">&#39;https://www.yahoo.co.jp/&#39;</span>)

time.sleep(3)

html = driver.page_source
<span style="color:#00f">print</span>(html)

driver.save_screenshot(<span style="color:#a31515">&#34;hoge.png&#34;</span>)

driver.quit()</code></pre></div>
<p>結果は・・・<strong>変化なし！</strong></p>

<h3 id="その2-proxy設定を追加">（その2）Proxy設定を追加</h3>

<p>たまたま実行環境がProxyの影響下だったので、<a href="https://teratail.com/questions/183399">ここ</a>を参考にして、SeleniumにProxyの設定を盛り込んでみました。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#00f">import</span> time
<span style="color:#00f">from</span> selenium <span style="color:#00f">import</span> webdriver
<span style="color:#00f">from</span> selenium.webdriver.chrome.options <span style="color:#00f">import</span> Options
<span style="color:#00f">from</span> selenium.webdriver.common.proxy <span style="color:#00f">import</span> Proxy, ProxyType

options = Options()
options.add_argument(<span style="color:#a31515">&#39;--headless&#39;</span>)
options.add_argument(<span style="color:#a31515">&#39;--disable-gpu&#39;</span>)
options.binary_location = <span style="color:#a31515">&#39;Chrome Canaryのアドレス&#39;</span>

desired_caps = options.to_capabilities()

prox = Proxy()
prox.proxy_type = ProxyType.MANUAL
prox.http_proxy = <span style="color:#a31515">&#34;Proxyのアドレス&#34;</span>
prox.add_to_capabilities(desired_caps)

driver = webdriver.Chrome(options=options, desired_capabilities=desired_caps)

driver.get(<span style="color:#a31515">&#39;https://www.yahoo.co.jp/&#39;</span>)

time.sleep(3)

html = driver.page_source
<span style="color:#00f">print</span>(html)

driver.save_screenshot(<span style="color:#a31515">&#34;hoge.png&#34;</span>)

driver.quit()</code></pre></div>
<p>結果は・・・<strong>変化なし！</strong></p>

<p>2連敗・・・。</p>

<h3 id="その3-chromedriverに設定値を追加する">（その3）Chromedriverに設定値を追加する</h3>

<p><a href="https://qiita.com/saamonumai/items/4e5dd3448cd232bb26e0">ここ</a>を参考に、Chromedriverの設定を追加してみました。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#00f">import</span> time
<span style="color:#00f">from</span> selenium <span style="color:#00f">import</span> webdriver
<span style="color:#00f">from</span> selenium.webdriver.chrome.options <span style="color:#00f">import</span> Options
<span style="color:#00f">from</span> selenium.webdriver.common.desired_capabilities <span style="color:#00f">import</span> DesiredCapabilities

options = Options()
options.add_argument(<span style="color:#a31515">&#39;--headless&#39;</span>)
options.add_argument(<span style="color:#a31515">&#39;--disable-gpu&#39;</span>)
options.binary_location = <span style="color:#a31515">&#39;Chrome Canaryのアドレス&#39;</span>

caps = DesiredCapabilities.CHROME.copy()
caps[<span style="color:#a31515">&#39;acceptInsecureCerts&#39;</span>] = True

driver = webdriver.Chrome(options=options, desired_capabilities=caps)

driver.get(<span style="color:#a31515">&#39;https://www.yahoo.co.jp/&#39;</span>)

time.sleep(3)

html = driver.page_source
<span style="color:#00f">print</span>(html)

driver.save_screenshot(<span style="color:#a31515">&#34;hoge.png&#34;</span>)

driver.quit()</code></pre></div>
<p>結果は・・・<strong>変化なし！</strong></p>

<p>3連敗か・・・。</p>

<h3 id="ここまで3連敗">ここまで3連敗</h3>

<p>いかんせん、もともとWindows環境で実行しているのは少数派だからか、情報が少ないことのが痛いです。さらに、「自分はこれで動いたぜ」っていう方法を実行してもことごとくだめなので、そもそも別の要素が影響しているんじゃないか、という疑心暗鬼に陥る始末。</p>

<p>・・・と、そんなときに救世主が表れました。</p>

<h2 id="firefoxがあるじゃないか">Firefoxがあるじゃないか</h2>

<p>そうです、ChromeでダメならFirefoxにすればいいのです。<strong>動けば正義！</strong></p>

<p>というわけで環境を準備します。</p>

<h3 id="geckodriverをインストールする">geckodriverをインストールする</h3>

<p>chromedriverのFirefox版です。<a href="https://github.com/mozilla/geckodriver">こちら</a>からダウンロードした実行形式ファイルを任意の場所に展開して、パスを通しておきます。</p>

<p>なお、<code>pip</code>などで導入すれば他のPythonパッケージと同様にバージョン管理ができます。さらに、パス設定をする必要もないので楽です。どちらを選択するかはお好みで。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">$ geckodriver --version
geckodriver 0.26.0 (e9783a644016 2019-10-10 13:38 +0000)</code></pre></div>
<h3 id="firefox版のソースを準備する">Firefox版のソースを準備する</h3>

<p>Firefox用に準備したソースはこんな感じ。</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#00f">import</span> time
<span style="color:#00f">from</span> selenium <span style="color:#00f">import</span> webdriver
<span style="color:#00f">from</span> selenium.webdriver.firefox.options <span style="color:#00f">import</span> Options

options = Options()
options.add_argument(<span style="color:#a31515">&#39;-headless&#39;</span>)
driver = webdriver.Firefox(firefox_options=options)

driver.get(<span style="color:#a31515">&#39;https://www.yahoo.co.jp/&#39;</span>)

time.sleep(3)

html = driver.page_source
<span style="color:#00f">print</span>(html)

driver.save_screenshot(<span style="color:#a31515">&#34;hoge.png&#34;</span>)

driver.quit()</code></pre></div>
<p>だいぶ簡略化してるんで何もないですが、これを実行してみましょう。</p>

<h3 id="実行する">実行する</h3>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-console" data-lang="console">&lt;html lang=&#34;ja&#34;&gt;&lt;head&gt;&lt;meta charset=&#34;utf-8&#34;&gt;&lt;meta http-equiv=&#34;X-UA-Compatible&#34; content=&#34;IE=edge,chrome=1&#34;&gt;&lt;title&gt;Yahoo! JAPAN&lt;/title&gt;&lt;meta name=&#34;description&#34; content=&#34;あなたの毎日をアップデートする情報ポータル。検索、
ニュース、天気、スポーツ、メール、ショッピング、オークションなど便利なサービスを展開しています。&#34;&gt;&lt;meta name=&#34;robots&#34; content=&#34;noodp&#34;&gt;&lt;meta name=&#34;viewport&#34; content=&#34;width=1010&#34;&gt;&lt;link rel=&#34;dns-prefetch&#34; href=&#34;//s.yimg.jp&#34;&gt;&lt;link rel=&#34;dns-prefetch&#34; href=&#34;//yads.c.yimg.jp&#34;&gt;&lt;meta name=&#34;google-site-verification&#34; content=&#34;fsLMOiigp5fIpCDMEVodQnQC7jIY1K3UXW5QkQcBmVs&#34;&gt;&lt;link rel=&#34;alternate&#34; href=&#34;android-app://jp.co.yahoo.android.yjtop/yahoojapan/home/top&#34;&gt;&lt;link rel=&#34;alternate&#34; media=&#34;only screen and (max-width: 640px)&#34; href=&#34;https://m.yahoo.co.jp/&#34;&gt;&lt;link rel=&#34;canonical&#34; href=&#34;https://www.yahoo.co.jp/&#34;&gt;&lt;link rel=&#34;shortcut icon&#34; href=&#34;https://s.yimg.jp/c/icon/s/bsc/2.0/favicon.ico&#34; type=&#34;image/vnd.microsoft.icon&#34;&gt;&lt;link rel=&#34;icon&#34; href=&#34;https://s.yimg.jp/c/icon/s/bsc/2.0/favicon.ico&#34; type=&#34;image/vnd.microsoft.icon&#34;&gt;&lt;meta property=&#34;og:title&#34; content=&#34;Yahoo! JAPAN&#34;&gt;&lt;meta property=&#34;og:type&#34; content=&#34;website&#34;&gt;&lt;meta property=&#34;og:url&#34; content=&#34;https://www.yahoo.co.jp/&#34;&gt;&lt;meta property=&#34;og:image&#34; content=&#34;https://s.yimg.jp/images/top/ogp/fb_y_1500px.png&#34;&gt;&lt;meta property=&#34;og:description&#34; content=&#34;あなたの毎日をアップデートする情報ポータル。検索、ニュース、天気、スポーツ、メール、ショッピング、オークションなど便利なサービスを展開しています。&#34;&gt;&lt;meta property=&#34;og:site_name&#34; content=&#34;Yahoo! JAPAN&#34;&gt;&lt;meta property=&#34;twitter:card&#34; content=&#34;summary_large_image&#34;&gt;&lt;meta property=&#34;twitter:site&#34; content=&#34;@Yahoo_JAPAN_PR&#34;&gt;&lt;meta property=&#34;twitter:image&#34; content=&#34;https://s.yimg.jp/images/top/ogp/tw_y_1400px.png&#34;&gt;&lt;meta property=&#34;fb:app_id&#34;
content=&#34;472870002762883&#34;&gt;&lt;link rel=&#34;stylesheet&#34; href=&#34;//s.yimg.jp/images/top/orion/1.0.17/bundle_1.0.17.css&#34;&gt;&lt;script async=&#34;&#34; data-jsonpid=&#34;&#34; src=&#34;https://cdn-gl.imrworldwide.com/novms/js/2/nlsSDK600.bundle.min.js&#34;&gt;&lt;/script&gt;&lt;script async=&#34;&#34; src=&#34;https://cdn-gl.imrworldwide.com/conf/P2ED650F9-2101-4CB9-845D-ED37E7119BAD.js#name=nSdkInstance&amp;amp;ns=NOLBUNDLE&#34;&gt;&lt;/script&gt;・・・（以下省略）・・・</code></pre></div>
<p><strong>やったぜ！</strong></p>

<p><img src="2019-11-13-16-15-51.png" alt="pic" /></p>

<p>ちゃんとスクリーンショットも取得できています。<strong>やったぜ！</strong></p>

<h2 id="まとめ">まとめ</h2>

<p><strong>Firefoxはいいぞ</strong>。</p>

<p>結局のところ、なんでHeadlessモードのChromeで正常にHTMLを取得できないのか、根本的な解決には至りませんでした。ちなみに、今でも謎です。とくに「ソースをいじってないのに、Headlessモードを外しただけで正常に取得できる」ってのがホントに解せないです。検索すると、そこそこ上記のような現象はあるようなのですが、レアケースっぽいですね。</p>

<p>とりあえず自動化しなくちゃいけないケースでは、Firefoxを利用しようと思います。よろしく、Firefox。</p>

		</div><div id="disqus_thread"></div>
<script type="text/javascript">
	(function () {
		
		
		if (window.location.hostname == "localhost")
			return;

		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		var disqus_shortname = 'come-as-you-are';
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
		Disqus.</a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div> © Copyright ysko |  <a href="https://github.com/vividvilla/ezhil">Ezhil theme</a> | Built with <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-140331728-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<script>feather.replace()</script>
</body>
</html>
